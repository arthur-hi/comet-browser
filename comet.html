<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://kit.fontawesome.com/a40b56a9a8.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="halfmoon.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>

    <header id="titlebar">

      <div id="drag-region">
        <a id="window-title" href="#" onclick="button(`comet://home`)">
          <span><i class="fa-solid fa-house-chimney-window"></i></span>
        </a>
        <div id="window-controls">
          <div class="button" id="min-button">
            <img class="icon" srcset="icons/min-w-10.png 1x, icons/min-w-12.png 1.25x, icons/min-w-15.png 1.5x, icons/min-w-15.png 1.75x, icons/min-w-20.png 2x, icons/min-w-20.png 2.25x, icons/min-w-24.png 2.5x, icons/min-w-30.png 3x, icons/min-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="max-button">
            <img class="icon" srcset="icons/max-w-10.png 1x, icons/max-w-12.png 1.25x, icons/max-w-15.png 1.5x, icons/max-w-15.png 1.75x, icons/max-w-20.png 2x, icons/max-w-20.png 2.25x, icons/max-w-24.png 2.5x, icons/max-w-30.png 3x, icons/max-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="restore-button">
            <img class="icon" srcset="icons/restore-w-10.png 1x, icons/restore-w-12.png 1.25x, icons/restore-w-15.png 1.5x, icons/restore-w-15.png 1.75x, icons/restore-w-20.png 2x, icons/restore-w-20.png 2.25x, icons/restore-w-24.png 2.5x, icons/restore-w-30.png 3x, icons/restore-w-30.png 3.5x" draggable="false" />
          </div>
          <div class="button" id="close-button">
            <img class="icon" srcset="icons/close-w-10.png 1x, icons/close-w-12.png 1.25x, icons/close-w-15.png 1.5x, icons/close-w-15.png 1.75x, icons/close-w-20.png 2x, icons/close-w-20.png 2.25x, icons/close-w-24.png 2.5x, icons/close-w-30.png 3x, icons/close-w-30.png 3.5x" draggable="false" />
          </div>
        </div>
      </div>
      
      <div id="tab-system">
        <div class="container-fluid">
          <div class="row" id="top-bar">
            <div class="container-fluid" id="tab-container">
              <div class="row" id="tabs">
                <a class="col-3 tab" id="tab-bar" href="#">
                  <form onsubmit="lookup(this);return false">
                    <input id="input" value=""></input>
                  </form>
                  <span id="title">New Tab</span>
                </a>
                <a class="col-3 tab" id="tab-bar" href="#">
                  <form onsubmit="lookup(this);return false">
                    <input id="input" value=""></input>
                  </form>
                  <span id="title">New Tab</span>
                </a>
                <a class="col-3 tab" id="tab-bar" href="#">
                  <form onsubmit="lookup(this);return false">
                    <input id="input" value=""></input>
                  </form>
                  <span id="title">New Tab</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

    </header>

    <div id="main"></div>

    <script>
      require('./renderer.js')
      var fs = require("fs");

      var main = document.getElementById("main")
      tabs = document.getElementById("tabs").querySelectorAll("a")

      function lookup(form) {
        
        tabs.forEach(tab => {
          if(!tab.classList.contains('focused')){
            tab.className = "tab col-3";
          }
        })
        form.parentElement.className="tab focused-small col-3";
        form.parentElement.querySelector("#input").style.display = "none"
        form.parentElement.querySelector("#title").style.display = null

        input = form.querySelector('#input')
        if(input.value.substr(0,4)!="http"){
          webview = document.createElement("webview");
          webview.setAttribute("src", `https://${input.value}`)
          webview.setAttribute("style", `width: 100%; height: 100%`)
          main.innerHTML=null
          main.appendChild(webview)
        }
        if(input.value.split('://')[0]=="comet"){
          try {
            var page = fs.readFileSync(`./comet/${input.value.split('://')[1]}.html`).toString('utf-8');
            main.innerHTML = page
            form.parentElement.querySelector("#title").innerText = input.value.split('://')[1]
          } catch (error) {
            main.innerHTML = `
            <h1>
              ðŸ˜Ÿ Something went wrong!
            </h1>
            <br>
            <p>
              ## ${error}
            </p>
            `
          }
        }
      }
      function button(value) {

        tabs.forEach(tab => {
          if(!tab.classList.contains('focused')){
            tab.className = "tab col-3";
          }
          if(tab.classList.contains('focused')){
            tab.querySelector("#title").innerText=value.split('://')[1]
            tab.querySelector("#input").value=value
            tab.className = "tab focused col-3";
            tab.querySelector("#input").style.display = "none"
            tab.querySelector("#title").style.display = null
          }
        })

        if(value.substr(0,4)!="http"){
          webview = document.createElement("webview");
          webview.setAttribute("src", `https://${value}`)
          main.innerHTML = "<p>## Insert .25f transition between sites...</p>"
          main.appendChild(webview)
        }
        if(value.split('://')[0]=="comet"){
          try {
            var page = fs.readFileSync(`./comet/${value.split('://')[1]}.html`).toString('utf-8');
            main.innerHTML = page
          } catch (error) {
            main.innerHTML = `
            <h1>
              ðŸ˜Ÿ Something went wrong!
            </h1>
            <br>
            <p>
              ## ${error}
            </p>
            `
          }
        }
      }
    </script>
    
  </body>
</html>